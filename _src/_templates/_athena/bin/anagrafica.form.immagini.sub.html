{% macro immaginiCollegate( table, subtable, legend, site, page, pages, lang, etc, request, session ) %}
{% import '_bin/_form.html' as frm %}
{% set counter = 0 %}
<fieldset id="{{ subtable }}">
    {{ frm.subformLegend( subtable, legend ) }}
    {% if request[ table ][ subtable ]|length %}{% set t = request[ table ][ subtable ]|length - 1 %}
    {% else %}{% set t = 0 %}{% endif %}
    {% for i in 0..t %}
    {% set r = request[ table ][ subtable ][ i ] %}
    {% if session.account.id %}{% set account = session.account.id %}{% else %}{% set account = '__null__' %}{% endif %}
    {% if request[ table ][ subtable ][ i ].id %}{% set action = 'aggiornamento' %}
    {% else %}{% set action = 'inserimento' %}{% endif %}
    {% set timestamp = 'now'|date('U') %}
    <div id="{{ subtable }}_{{ i }}">
	{{ frm.input( table, subtable, i, 'id', '', '', request, '', 'hidden' ) }}
	{{ frm.input( table, subtable, i, 'id_immagine', '', '', '', '__parent_id__', 'hidden' ) }}
	<div class="form-group form-row">
    <div class="col-6">
        {{ frm.selectRequired( table, subtable, i, 'nome', '', etc.select.immagini_collegate, request ) }}
    </div>
	    <div class="col text-right">
		{% if r.id %}
		{{ frm.button( '<i class="fa fa-trash"></i>', 'button', 'btn-secondary btn-sqr remove-on-duplicate', 'window.open("' ~ pages.cancellazione.path[ lang ] ~ '?__delete__[table]=' ~ subtable ~'&__delete__[id]=' ~ r.id ~ '&__delete__[target]=' ~ page.path[ lang ] ~ '?' ~ table ~ '[id]=' ~ request[ table ].id ~ '","_self")' ) }}
		{% endif %}
	    </div>
	</div>
    </div>
    {% endfor %}
</fieldset>
{% endmacro %}
