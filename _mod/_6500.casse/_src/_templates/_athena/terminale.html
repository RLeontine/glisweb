{% import '_bin/_default.html' as cms %}
{% import '_bin/_form.html' as frm %}
{% import 'bin/default.html' as def %}

{% extends 'ext/blank.html' %}

{# DEFINIZIONI #}
{% set table = form.table %}
{% set ietf = localization.language.ietf %}

{# ACCOUNT #}
{% if session.account.id %}
    {% set account = session.account.id %}
{% else %}
    {% set account = '__null__' %}
{% endif %}

{# TIPO DI METODO E ATTIVITA' SVOLTA #}
{% if request[ table ].id %}
    {% set method = 'update' %}
    {% set activity = 'aggiornamento' %}
    {% set legend = 'aggiornato ' ~ request[ table ][ 'timestamp_aggiornamento' ]|date('Y/m/d H:i:s') %}
{% else %}
    {% set method = 'post' %}
    {% set activity = 'inserimento' %}
    {% set legend = 'inserimento nuovo oggetto' %}
{% endif %}
{% block javascript %}

<script >

    function anteprima(){

       document.getElementById("form-documenti").submit();
       // console.log('{{ pages[anteprima.documento].url[ localization.language.ietf ] }}?id={{ request.documenti.id }}');
        window.open( 'http://localhost/casse/anteprima.it-IT.html?id={{ request.documenti.id }}', '_self' );
    }
    
</script>

{% endblock %}
{% block header %}
<header class="fixed-top">
<div class="row widget no-gutters">
    <div class="col text-left">
        {% set target = pages.casse.url[ localization.language.ietf ] %}
        <button type="button" class="btn btn-secondary btn-sqr btn-sm" onclick="window.open( '{{ target }}', '_self' );" data-toggle="tooltip" data-placement="bottom" data-delay="1000" title="torna alla dashboard"><i class="fa fa-arrow-circle-o-left" aria-hidden="true"></i></button>

    </div>
       <div class="col text-right">
      
    </div>
</header>
{% endblock %}

{% block main %}
{% set cassa = pages.terminale.url[ localization.language.ietf ] %}

<form id="form-{{ table }}" class="form-main d-flex flex-column flex-fill" action="{{ page.path[ ietf ] }}" method="post" autocomplete="off">

    {# CAMPI HIDDEN DI BASE #}
    <input type="hidden" id="id" name="{{ table }}[id]" value="{{ request[ table ].id }}">
    <input type="hidden" id="method" name="{{ table }}[__method__]" value="{{ method }}">
    <input type="hidden" id="reset" name="{{ table }}[__reset__]" value="">
    <input type="hidden" id="id_emittente" name="{{ table }}[id_emittente]" value="{{ etc.id_emittente }}">
    <input type="hidden" id="dato" name="{{ table }}[data]" value="{{ 'now'|date('Y-m-d') }}">
    <input type="hidden" id="numero" name="{{ table }}[numero]" value="{{ 'now'|date('U') }}">
    <input type="hidden" id="timestamp" name="{{ table }}[timestamp_{{ activity }}]" value="{{ 'now'|date('U') }}">
    <input type="hidden" id="account" name="{{ table }}[id_account_{{ activity }}]" value="{{ account }}">
    <input type="hidden" id="tipologia" name="{{ table }}[id_tipologia]" value="9">

    {% if request.__backurl__ %}{# TODO VEDERE SE FUNZIONA ANCHE COSÌ FUORI DALL'IF #}{% endif %}
    <input type="hidden" id="backurl" name="__backurl__" value="{{ request.__backurl__ }}">
{% if not request.documenti.id %}
    <div class="col-12 mt-3 cassa">
        <button type="sumbit" class="btn btn-secondary btn-sqr btn-block" data-toggle="tooltip" data-placement="bottom" data-delay="1000" title="torna alla dashboard">apri</button>
    </div>
{% else %}


    <div class="container-fluid pannello-cassa">
        <div class="row">
            <div class="col-5 align-items-center">
                <legend>documento</legend>
                    <div class="row">
                        <div class="col-12">
                            <span class="label-top">tipologia</span>
                            {{ frm.select( table, '', '', 'id_tipologia', '', etc.select.tipologie_documenti, request, '1', '', '1', '1', '' ) }}
                        </div>
                        <div class="col-12 mt-3">
                            <span class="label-top">cliente</span>
                            {{ frm.selectBox( table, '', '', 'id_destinatario', '', etc.select.anagrafica, request, '', '', '', '', '', 'anagrafica.form', 'anagrafica.form', 'anagrafica', 'id_destinatario', page, pages, ietf, 'anagrafica' ) }}
                        </div>
                    <!--inizio prova scontrino-->
                    <div class="col-12 mt-3">
                        {% if etc.righe %}
                        <div id="bot">
                            <div id="table" >
                                <table style="width:100%;">
                                    <tr class="tabletitle">
                                        <td class="item"><h2>articolo</h2></td>
                                        <td class="Hours"><h2>prezzo</h2></td>
                                        <td class="Hours"><h2>quantità</h2></td>
                                        <td class="Rate"><h2>sub totale</h2></td>
                                        <td class="Rate"><h2>reparto</h2></td>
                                    </tr>
                                </table>
                            </div>
                        </div> 
                        {% endif %}
                    <div class="col-12 mt-3 box mh-100 "  id="invoice-POS">
                        <div id="table" >
                            <table style="width:100%;">              
                                        {% for riga in etc.righe %}
                                            <tr class="service">
                                                <td class="tableitem"><p class="itemtext">{{ riga.id_articolo }}</p></td>
                                                <td class="tableitem"><p class="itemtext">{{ riga.importo_netto_totale }}</p></td>
                                                <td class="tableitem"><p class="itemtext">{{ riga.quantita }}</p></td>
                                                <td class="tableitem"><p class="itemtext">{{ riga.importo_netto_totale * riga.quantita }}</p></td>
                                                <td class="tableitem"><p class="itemtext">{{ riga.reparto }}</p></td>                                            
                                            </tr>
                                        {% endfor %}
                                        </table>
                                    </div>
                    </div> 
                    <div class="col-12 mt-3 d-flex justify-content-end" >
                        <div id="table" >
                            <table style="width:100%;">      
                                    {% if etc.totale %}
                                            <tr class="tabletitle">
                                                <td>&nbsp;</td>
                                                <td class="Rate"><h1>IVA</h1></td>
                                                <td class="payment"><h1></h1></td>
                                            </tr>

                                            <tr class="tabletitle">
                                                <td>&nbsp;</td>
                                                <td class="Rate"><h1>Totale</h1></td>
                                                <td class="payment"><h1>{{ etc.totale }}</h1></td>
                                            </tr>
                                    {% endif %}
                                        </table>
                                    </div><!--End Table-->
                                </div><!--End InvoiceBot-->
                </div><!--End Invoice-->

<!--fine prova scontrino-->


                </div>  
                <!--div class="col mt-3 mt-auto">
                    <button type="button" class="btn btn-secondary btn-sqr btn-block" onclick="window.open( '{{ cassa }}', '_self' );" data-toggle="tooltip" data-placement="bottom" data-delay="1000" title="torna alla dashboard">annulla</button>
            </div-->
            </div>
            <div class="col-5 align-items-center">
                <legend>comando</legend>
                    <div class="form-row row"> 
                                <div class="col ">
                                    {{ frm.input( table, '', '', '__comando__', '', '' ) }}
                                </div>
                                <div class="col-auto">
                                    {{ frm.select( table, '', '', '__reparto__', '', etc.select.reparti, request, 0, '', 1, 1  ) }}
                                </div>
                                <div class="col-auto ">
                                    {{ frm.select( table, '', '', '__operazione__', '', etc.select.operazioni, request, 1, '', 1,1  ) }}
                                </div>
                    </div>
                    <div class="row">
                        <div class="col-12"><legend>tastiera</legend></div>
                    </div>
                    <div class="row " style="align-self: flex-end;">
                        <div class="col-12"><legend>chiusura scontrino</legend></div>

                        <div class="col-6 mt-3 cassa">
                            <button type="button" class="btn btn-secondary btn-sqr btn-block" onclick="window.open( '{{ cassa }}', '_self' );" data-toggle="tooltip" data-placement="bottom" data-delay="1000" title="torna alla dashboard"><i class="fa fa-money" aria-hidden="true"></i></button>
                        </div>
                        <div class="col-6 mt-3 cassa">
                            <button type="button" class="btn btn-secondary btn-sqr btn-block" onclick="window.open( '{{ cassa }}', '_self' );" data-toggle="tooltip" data-placement="bottom" data-delay="1000" title="torna alla dashboard"><i class="fa fa-credit-card" aria-hidden="true"></i></button>
                        </div>
                        <div class="col-12 mt-3 cassa">
                            <button type="button" class="btn btn-secondary btn-sqr btn-block" onclick="anteprima()" data-toggle="tooltip" data-placement="bottom" data-delay="1000" title="torna alla dashboard">stampa</button>
                        </div>
                    </div>
            </div>


            <div class="col-2 align-items-center"  >
                <legend>articoli frequenti</legend>
            <div class="box" style="height: 85vh;" >
                {% for articolo in etc.articoli_frequenti %}
                <a href="{{ cassa }}?documenti[id]={{ request.documenti.id  }}&__art__={{ articolo.id }}">
                <div class="media">
                   
                    <div class="media-body p-3">
                      <h3 class="mt-0">{{ articolo.__label__ }}</h3>
                      <p>{{ articolo.testo|raw }}</p>
                      
                    </div>
                  </div>
                  </a>
                  {% endfor %}
                </div>
                </div>
        </div>
    </div>

    {% endif %}
</form>
{% endblock %}

